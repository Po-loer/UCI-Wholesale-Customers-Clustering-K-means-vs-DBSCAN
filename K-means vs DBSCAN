{
  "cells": [
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "fbfb13ab-4c52-424c-9aae-ec3a13f42e50",
      "metadata": {
        "id": "fbfb13ab-4c52-424c-9aae-ec3a13f42e50"
      },
      "outputs": [],
      "source": [
        "# Group 2: Wholesale Customers Clustering (K-means vs DBSCAN)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "cac27eaa-a5c1-433f-bf91-d57330a38371",
      "metadata": {
        "id": "cac27eaa-a5c1-433f-bf91-d57330a38371"
      },
      "outputs": [],
      "source": [
        "import pandas as pd, numpy as np, matplotlib.pyplot as plt, seaborn as sns\n",
        "from sklearn.preprocessing import RobustScaler\n",
        "from sklearn.cluster import KMeans, DBSCAN\n",
        "from sklearn.decomposition import PCA\n",
        "from sklearn.metrics import silhouette_score, davies_bouldin_score\n",
        "from sklearn.neighbors import NearestNeighbors\n",
        "from scipy.stats import kruskal, chi2_contingency\n",
        "sns.set(style='whitegrid')\n"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "dd35f0c6-bef3-4ad3-9639-b4afc9de1c6d",
      "metadata": {
        "id": "dd35f0c6-bef3-4ad3-9639-b4afc9de1c6d"
      },
      "outputs": [],
      "source": [
        "# Part A: Data Loading & Preprocessing\n",
        "# CSV path\n",
        "file_path = r\"C:\\Users\\HP G3\\Desktop\\Artificial-Intelligence\\GROUP 2 (ASSIGNMENT 3)\\Wholesale customers data.csv\"\n",
        "\n",
        "df = pd.read_csv(file_path)\n",
        "print('Initial shape:', df.shape)\n",
        "print(df.dtypes)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "b4b988c6-c994-4a7d-a991-b17d001a6d24",
      "metadata": {
        "id": "b4b988c6-c994-4a7d-a991-b17d001a6d24"
      },
      "outputs": [],
      "source": [
        "# Handle missing & duplicates\n",
        "df = df.fillna(df.median(numeric_only=True)).drop_duplicates()\n",
        "print('Shape after cleaning:', df.shape)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "a3122af3-d6dc-46fd-a757-c7709ace28ff",
      "metadata": {
        "id": "a3122af3-d6dc-46fd-a757-c7709ace28ff"
      },
      "outputs": [],
      "source": [
        "# Scale numeric features\n",
        "num_cols = df.select_dtypes(include=[np.number]).columns.tolist()\n",
        "scaler = RobustScaler()\n",
        "X_scaled = scaler.fit_transform(df[num_cols])"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "9050b069-0174-4b25-ba6a-3189f7a5c2a5",
      "metadata": {
        "id": "9050b069-0174-4b25-ba6a-3189f7a5c2a5"
      },
      "outputs": [],
      "source": [
        "# Handle missing & duplicates\n",
        "df = df.fillna(df.median()).drop_duplicates()\n",
        "print('Shape after cleaning:', df.shape)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "0c05fccf-6dc7-47da-a17a-5a4c8ac9b772",
      "metadata": {
        "id": "0c05fccf-6dc7-47da-a17a-5a4c8ac9b772"
      },
      "outputs": [],
      "source": [
        "# Scale numeric features\n",
        "num_cols = df.select_dtypes(include=[np.number]).columns.tolist()\n",
        "scaler = RobustScaler()\n",
        "X_scaled = scaler.fit_transform(df[num_cols])"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "ceb4d7b3-df2c-4a09-adf2-c8acf1b3af73",
      "metadata": {
        "id": "ceb4d7b3-df2c-4a09-adf2-c8acf1b3af73"
      },
      "outputs": [],
      "source": [
        "# Part B: First EDA\n",
        "print(df[num_cols].describe())\n",
        "plt.figure(figsize=(10,5)); sns.boxplot(data=df[num_cols]); plt.title('Boxplots'); plt.show()"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "f0b89539-4f57-4b5d-a69d-6162a5078651",
      "metadata": {
        "id": "f0b89539-4f57-4b5d-a69d-6162a5078651"
      },
      "outputs": [],
      "source": [
        "# Log-transform skewed vars\n",
        "skewed = df[num_cols].skew().abs() > 1\n",
        "df_log = df.copy()\n",
        "for c in df.columns[skewed]: df_log[c] = np.log1p(df[c])\n",
        "\n",
        "plt.figure(figsize=(8,5))\n",
        "sns.heatmap(df[num_cols].corr(), annot=True, cmap='coolwarm')\n",
        "plt.title('Correlation heatmap')\n",
        "plt.show()"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "07137b35-eee2-48bd-985f-d8e78ec6635e",
      "metadata": {
        "id": "07137b35-eee2-48bd-985f-d8e78ec6635e"
      },
      "outputs": [],
      "source": [
        "# Part C: Feature Engineering\n",
        "df['TotalSpend'] = df[num_cols].sum(axis=1)\n",
        "df['ProportionFresh'] = df['Fresh']/df['TotalSpend']\n",
        "df['LogTotalSpend'] = np.log1p(df['TotalSpend'])"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "d3b73bea-aaba-44ee-968d-644b72135678",
      "metadata": {
        "id": "d3b73bea-aaba-44ee-968d-644b72135678"
      },
      "outputs": [],
      "source": [
        "# Part D: Clustering Modelling\n",
        "X = df[num_cols].apply(np.log1p)\n",
        "X['LogTotalSpend'] = df['LogTotalSpend']\n",
        "X['ProportionFresh'] = df['ProportionFresh'].fillna(0)\n",
        "X_scaled = RobustScaler().fit_transform(X)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "77dbbdd7-1c0b-47ba-9a2e-71a7283e2b62",
      "metadata": {
        "id": "77dbbdd7-1c0b-47ba-9a2e-71a7283e2b62"
      },
      "outputs": [],
      "source": [
        "# K-means (k=2..8)\n",
        "res=[]\n",
        "for k in range(2,9):\n",
        "    km=KMeans(n_clusters=k,random_state=0,n_init=10)\n",
        "    lab=km.fit_predict(X_scaled)\n",
        "    res.append((k,silhouette_score(X_scaled,lab),davies_bouldin_score(X_scaled,lab)))\n",
        "km_df=pd.DataFrame(res,columns=['k','Silhouette','DB_index'])\n",
        "print(km_df)\n",
        "\n",
        "best_k=int(km_df.sort_values(['Silhouette','DB_index'],ascending=[False,True]).iloc[0]['k'])\n",
        "km_final=KMeans(n_clusters=best_k,random_state=0,n_init=20).fit(X_scaled)\n",
        "k_labels=km_final.labels_"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "628759d3-3b6b-4247-880c-883bcfe9b817",
      "metadata": {
        "id": "628759d3-3b6b-4247-880c-883bcfe9b817"
      },
      "outputs": [],
      "source": [
        "# DBSCAN\n",
        "nbrs=NearestNeighbors(n_neighbors=4).fit(X_scaled)\n",
        "distances=np.sort(nbrs.kneighbors(X_scaled)[0][:,3])\n",
        "plt.plot(distances);plt.title('k-distance plot');plt.show()\n",
        "\n",
        "db=DBSCAN(eps=0.6,min_samples=5).fit(X_scaled)\n",
        "db_labels=db.labels_\n",
        "\n",
        "print('K-means clusters:',np.unique(k_labels,return_counts=True))\n",
        "print('DBSCAN clusters:',np.unique(db_labels,return_counts=True))"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "25b41bbe-bfd0-4146-803e-e8dc467bcd80",
      "metadata": {
        "id": "25b41bbe-bfd0-4146-803e-e8dc467bcd80"
      },
      "outputs": [],
      "source": [
        "# Part E: Statistical Inference\n",
        "df['kmeans_cluster']=k_labels; df['dbscan_cluster']=db_labels\n"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "a3a4512e-221e-435c-9072-611ca99dd139",
      "metadata": {
        "id": "a3a4512e-221e-435c-9072-611ca99dd139"
      },
      "outputs": [],
      "source": [
        "# Kruskal-Wallis for TotalSpend\n",
        "groups=[g['TotalSpend'].values for _,g in df.groupby('kmeans_cluster')]\n",
        "print('Kruskal-Wallis (K-means):',kruskal(*groups))\n",
        "\n",
        "groups_db=[g['TotalSpend'].values for l,g in df.groupby('dbscan_cluster') if l!=-1]\n",
        "if len(groups_db)>1: print('Kruskal-Wallis (DBSCAN):',kruskal(*groups_db))"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "506aea33-f59f-4fee-97b5-67b79bd7e417",
      "metadata": {
        "id": "506aea33-f59f-4fee-97b5-67b79bd7e417"
      },
      "outputs": [],
      "source": [
        "# Chi-square if Channel present\n",
        "if 'Channel' in df.columns:\n",
        "    chi2,p,_,_=chi2_contingency(pd.crosstab(df['Channel'],df['kmeans_cluster']))\n",
        "    print('Chi-square (Channel vs K-means):',chi2,p)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "46684251-8e8c-4a44-a077-9fed7570fee1",
      "metadata": {
        "id": "46684251-8e8c-4a44-a077-9fed7570fee1"
      },
      "outputs": [],
      "source": [
        "# Part F: Visualization & Reflection\n",
        "pca=PCA(2).fit_transform(X_scaled)\n",
        "plt.figure(figsize=(10,4))\n",
        "plt.subplot(1,2,1); sns.scatterplot(x=pca[:,0],y=pca[:,1],hue=k_labels,palette='tab10'); plt.title('K-means PCA')\n",
        "plt.subplot(1,2,2); sns.scatterplot(x=pca[:,0],y=pca[:,1],hue=db_labels,palette='tab10'); plt.title('DBSCAN PCA'); plt.show()\n",
        "\n",
        "print('''\\nReflection:\\nK-means assumes spherical clusters and equal variance.\\nDBSCAN finds arbitrary shapes but depends on eps/min_samples.\\nUse clusters to identify high TotalSpend customers for targeted marketing.''')\n"
      ]
    }
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3 (ipykernel)",
      "language": "python",
      "name": "python3"
    },
    "language_info": {
      "codemirror_mode": {
        "name": "ipython",
        "version": 3
      },
      "file_extension": ".py",
      "mimetype": "text/x-python",
      "name": "python",
      "nbconvert_exporter": "python",
      "pygments_lexer": "ipython3",
      "version": "3.12.7"
    },
    "colab": {
      "provenance": []
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}
